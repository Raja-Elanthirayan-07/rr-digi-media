<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="RR Digi Media (Mayiladuthurai) — flex banner printing, photo prints, visiting cards and invitations. Fast turnaround, delivery or pickup, and transparent pricing." />
  <title>RR Digi Media — Banner Printing & Design</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="RRDigiMedia-Logo.jpg">
  <link rel="stylesheet" href="styles.css">
  <style>
  /* Unified section spacing to keep layouts consistent across anchors */
  .section{padding:24px;border-radius:12px;background:#fff}
  .section + .section{margin-top:24px}
  .section h3{margin-bottom:12px}
  /* Ensure consistent gutters */
  .section .row{--bs-gutter-x:1rem;--bs-gutter-y:1rem}
    /* RR Digi Media palette from logo: deep red + vibrant orange */
    :root{
      --brand:#d7261b;         /* primary red */
      --accent:#ff6f00;        /* orange accent */
      --brand-dark:#a3120d;    /* darker red for hover/focus */
      --muted:#6b7280;
      /* Bootstrap variable overrides */
      --bs-primary: var(--brand);
      --bs-primary-rgb: 215,38,27;
      --bs-link-color: var(--brand);
      --bs-link-hover-color: var(--brand-dark);
    }
    body{background:#fff;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    .nav-brand{font-weight:700;color:var(--brand);letter-spacing:0.6px}
    .hero-landing{
      background: radial-gradient(1200px 400px at 0% 0%, rgba(255,111,0,0.10) 0%, rgba(215,38,27,0.06) 50%, rgba(215,38,27,0.02) 100%);
      padding:80px 24px;border-radius:12px;margin-bottom:24px
    }
    .hero-landing h1{font-size:2.1rem;margin-bottom:.25rem}
    .hero-landing p{color:var(--muted);margin-bottom:18px}
    .features .card{border:1px solid #ffe4d6;background:#fff}
    .card-ghost{background:linear-gradient(180deg,#fff,#fff5ef);border:1px solid #ffe4d6}
    .logo{font-weight:700;color:var(--brand);letter-spacing:0.6px}
    .small-muted{font-size:.86rem;color:var(--muted)}
    .preview-img{max-height:120px;margin-right:.5rem;border-radius:6px;border:1px solid #ffe4d6;padding:3px}
    .required::after{content:" *";color:var(--brand)}
    footer{opacity:.85;margin-top:30px}
  /* Sticky navbar anchor offset without layout jump */
  .section{scroll-margin-top:90px}
    /* hidden order initially */
    #orderSection{display:none}
    /* quick fade-in when revealed */
    .reveal{animation:fadeIn 420ms ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    @media (min-width:992px){ .hero-landing h1{font-size:2.6rem} }

    /* Button accents to match logo */
    .btn-primary{background:var(--brand);border-color:var(--brand)}
    .btn-primary:hover{background:var(--brand-dark);border-color:var(--brand-dark)}
    .btn-outline-primary{color:var(--brand);border-color:var(--brand)}
    .btn-outline-primary:hover{background:var(--brand);color:#fff}
    .badge-accent{background:var(--accent);}
    
    /* Navbar underline hover */
    .navbar .nav-link{position:relative}
    .navbar .nav-link::after{content:"";position:absolute;left:0;right:0;bottom:0;height:2px;background:linear-gradient(90deg,var(--accent),var(--brand));transform:scaleX(0);transition:transform .2s ease}
    .navbar .nav-link:hover::after{transform:scaleX(1)}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#home">
        <img src="RRDigiMedia-Logo.jpg" alt="RR Digi Media logo" style="width:44px;height:44px;object-fit:cover;border-radius:50%;border:1px solid #ffe4d6" />
        <div>
          <div class="nav-brand">RR Digi Media</div>
          <div class="small-muted">Banner printing & design</div>
        </div>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
          <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
          <li class="nav-item ms-3"><button id="navOrder" class="btn btn-primary">Order Now</button></li>
          <li class="nav-item ms-2" id="authBtns"><a id="loginBtn" class="btn btn-outline-primary" href="login.html">Log in</a></li>
          <li class="nav-item ms-2" id="signupBtnWrap"><a id="signupBtn" class="btn btn-primary" href="signup.html">Sign up</a></li>
          <li class="nav-item dropdown ms-2 d-none" id="userMenu">
            <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <span id="userEmailMenu">Account</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item d-none" id="adminLink" href="admin.html">Admin Panel</a></li>
              <li><a class="dropdown-item" href="dashboard.html">Dashboard</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><button class="dropdown-item" id="logoutBtn">Log out</button></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="container py-5">
    <!-- HOME / HERO -->
  <section id="home" class="hero-landing section">
      <div class="row align-items-center gx-4">
        <div class="col-lg-7">
          <h1>Professional banner printing & expert design — local & fast</h1>
          <p>From small shop banners to large outdoor prints — upload your artwork or let our designers craft a banner that stands out. Secure online payment, delivery or pickup, and transparent pricing.</p>
          <div class="d-flex flex-wrap gap-2">
            <button id="ctaOrder" class="btn btn-primary btn-lg">Order Now</button>
            <a href="#contact" class="btn btn-outline-primary btn-lg">Contact Us</a>
          </div>
          <div class="mt-4 small-muted">
            <strong>Why RR Digi Media?</strong>
            <ul class="mb-0">
              <li>Quick turnaround — print-ready in 5–36 hours</li>
              <li>Design support included (optional)</li>
              <li>Secure online payment & delivery/pickup</li>
            </ul>
          </div>
        </div>

        <div class="col-lg-5 mt-4 mt-lg-0">
          <div class="card p-3">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <div>
                <div style="font-weight:700;font-size:1.1rem">Popular size</div>
                <div class="small-muted">6 ft × 4 ft — Normal Flex (print only)</div>
              </div>
              <div style="font-weight:700;font-size:1.25rem;color:var(--brand)">₹168</div>
            </div>
            <div class="small-muted">Free delivery on orders ₹2000+</div>
          </div>
        </div>
      </div>
    </section>

    <!-- SERVICES -->
    <section id="services" class="section">
      <h3>Our Services</h3>
      <div class="row features g-3">
        <div class="col-md-4">
          <div class="card p-3 h-100">
            <h6>Flex Banner Printing</h6>
            <p class="small-muted mb-0">Normal Flex, Star Flex, Vinyl — print only or design with print.</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card p-3 h-100">
            <h6>Visiting Cards & Invitations</h6>
            <p class="small-muted mb-0">Glassy, Matte, Die-cut, Velvet touch, Leaf, Non-tearable. Invitations (min 500).</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card p-3 h-100">
            <h6>Photo Prints & Lithos</h6>
            <p class="small-muted mb-0">Photo prints (size/design based) and Lithos printing (bulk orders).</p>
          </div>
        </div>
      </div>

      <hr class="my-4">

      <h5 class="mb-2">Price List</h5>
      <p class="small-muted mb-3">All rates are subject to confirmation based on material availability and final design requirements.</p>

      <div class="card p-3 mb-3">
        <h6 class="mb-2">Flex Banner Rates (per sq ft)</h6>
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Material</th>
                <th>Print only</th>
                <th>Design + Print</th>
                <th class="text-muted">Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Normal Flex</strong></td>
                <td>₹7 / sq ft</td>
                <td>₹10 / sq ft</td>
                <td class="text-muted">Design+print: above 100 sq ft (₹10/sq ft). Below 100 sq ft: piece rate ₹10.</td>
              </tr>
              <tr>
                <td><strong>Star Flex</strong></td>
                <td>₹20–₹25 / sq ft</td>
                <td>₹45 / sq ft</td>
                <td class="text-muted">Print-only varies by requirement; final confirmation after review.</td>
              </tr>
              <tr>
                <td><strong>Vinyl</strong></td>
                <td>₹40 / sq ft</td>
                <td>₹75 / sq ft</td>
                <td class="text-muted">Suitable for premium output.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card p-3 h-100">
            <h6 class="mb-2">Lithos</h6>
            <ul class="small-muted mb-0">
              <li>Design + printing (above 100 pieces): ₹1600</li>
              <li>Print only (100 nos): ₹950</li>
            </ul>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card p-3 h-100">
            <h6 class="mb-2">Invitations</h6>
            <div class="small-muted">Design and printing depends on material and design. Minimum quantity: <strong>500 nos</strong>.</div>
          </div>
        </div>
      </div>

      <div class="card p-3 mt-3">
        <h6 class="mb-2">Visiting Cards</h6>
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Type</th>
                <th>Price</th>
                <th>Details</th>
                <th>Minimum Quantity</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Glassy</td>
                <td>₹750</td>
                <td>Single side, single design</td>
                <td>1000</td>
              </tr>
              <tr>
                <td>Matte</td>
                <td>₹1100</td>
                <td>Single side, single design</td>
                <td>1000</td>
              </tr>
              <tr>
                <td>Die cut</td>
                <td>₹1500</td>
                <td>Single side, single design</td>
                <td>1000</td>
              </tr>
              <tr>
                <td>Velvet touch</td>
                <td>₹700</td>
                <td>Single side, single design</td>
                <td>100</td>
              </tr>
              <tr>
                <td>Leaf</td>
                <td>₹700</td>
                <td>Single side, single design</td>
                <td>100</td>
              </tr>
              <tr>
                <td>Non Tearable</td>
                <td>₹700</td>
                <td>Single side, single design</td>
                <td>100</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card p-3 mt-3">
        <h6 class="mb-2">Photo Print — Size & Design Based Price List</h6>
        <div class="small-muted mb-2">Prices shown are per piece.</div>
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Size</th>
                <th>Normal</th>
                <th>Gold Half</th>
                <th>Gold 1 Inch</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>12 × 18</td><td>₹600</td><td>₹800</td><td>₹900</td></tr>
              <tr><td>24 × 12</td><td>₹1000</td><td>₹1100</td><td>₹1200</td></tr>
              <tr><td>36 × 12</td><td>₹1200</td><td>₹1350</td><td>₹1450</td></tr>
              <tr><td>20 × 16</td><td>₹1400</td><td>₹1600</td><td>₹1700</td></tr>
              <tr><td>24 × 16</td><td>₹1800</td><td>₹1900</td><td>₹2000</td></tr>
              <tr><td>18 × 24</td><td>₹1600</td><td>₹1700</td><td>₹1800</td></tr>
              <tr><td>20 × 24</td><td>₹1800</td><td>₹1900</td><td>₹2000</td></tr>
              <tr><td>20 × 30</td><td>₹2500</td><td>₹2600</td><td>₹2700</td></tr>
              <tr><td>20 × 36</td><td>₹2800</td><td>₹3000</td><td>₹3200</td></tr>
              <tr><td>20 × 40</td><td>₹3300</td><td>₹3400</td><td>₹3600</td></tr>
              <tr><td>24 × 36</td><td>₹3500</td><td>₹3600</td><td>₹3700</td></tr>
              <tr><td>30 × 40</td><td>₹4300</td><td>₹4400</td><td>₹4500</td></tr>
              <tr><td>24 × 40</td><td>₹4300</td><td>₹4500</td><td>₹4600</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="section">
      <h3>About RR Digi Media</h3>
      <div class="card p-3">
        <p class="small-muted mb-0">RR Digi Media is a Mayiladuthurai-based print and design studio focused on fast, reliable service for businesses and events. We do flex banners, visiting cards, invitations, photo prints and more.</p>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="section">
      <div class="card p-3">
        <div class="row">
          <div class="col-md-8">
            <h6>Contact</h6>
            <p class="small-muted mb-0">Phone: <a href="tel:+919025647318">+91 90256 47318</a> • Email: <a href="mailto:rrdigimedia.myl@gmail.com">rrdigimedia.myl@gmail.com</a></p>
            <p class="small-muted">Shop: RR Digi Media, 24/50 Visalam Complex, Town Extension Road, Old bus stop back side, Mayiladuthurai 609001</p>
          </div>
          <div class="col-md-4 text-md-end align-self-center">
            <button id="contactOrderBtn" class="btn btn-primary">Start an Order</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ORDER SECTION (HIDDEN UNTIL ORDER NOW) -->
    <section id="orderSection" aria-hidden="true" class="mb-4">
      <div class="row">
        <div class="col-lg-7 mb-4">
          <div class="card card-ghost p-3">
            <h5 class="mb-3">Banner Order Form</h5>

            <form id="orderForm">
              <div class="mb-3">
                <label class="form-label required">What do you want to order?</label>
                <select id="orderCategory" class="form-select" required>
                  <option value="banner">Flex Banner</option>
                  <option value="photo">Photo Print</option>
                  <option value="visiting">Visiting Cards</option>
                  <option value="invitation">Invitations (Quote Request)</option>
                </select>
              </div>

              <div class="mb-3">
                <label class="form-label required">Select service</label>
                <select id="serviceType" class="form-select" required>
                  <option value="print">Print only (I have my artwork)</option>
                  <option value="design">Upload images & ask experts to design</option>
                </select>
                <div class="form-text">If you choose "design" our designers will contact you for clarifications.</div>
              </div>

              <div class="mb-3 d-none" id="photoGroup">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label required">Photo print size</label>
                    <select id="photoSize" class="form-select">
                      <option value="12x18">12 × 18</option>
                      <option value="24x12">24 × 12</option>
                      <option value="36x12">36 × 12</option>
                      <option value="20x16">20 × 16</option>
                      <option value="24x16">24 × 16</option>
                      <option value="18x24">18 × 24</option>
                      <option value="20x24">20 × 24</option>
                      <option value="20x30">20 × 30</option>
                      <option value="20x36">20 × 36</option>
                      <option value="20x40">20 × 40</option>
                      <option value="24x36">24 × 36</option>
                      <option value="30x40">30 × 40</option>
                      <option value="24x40">24 × 40</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label required">Design type</label>
                    <select id="photoDesign" class="form-select">
                      <option value="normal">Normal</option>
                      <option value="gold_half">Gold Half</option>
                      <option value="gold_1inch">Gold 1 Inch</option>
                    </select>
                  </div>
                </div>
                <div class="row g-3 mt-1">
                  <div class="col-md-6">
                    <label class="form-label required">Quantity</label>
                    <input id="photoQty" type="number" min="1" value="1" class="form-control" />
                    <div class="form-text">Quantity is per piece.</div>
                  </div>
                </div>
                <div class="form-text mt-2">Upload your photo(s) below. Prices are calculated based on size and design type.</div>
              </div>

              <div class="mb-3 d-none" id="visitingGroup">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label required">Card type</label>
                    <select id="visitingType" class="form-select">
                      <option value="glassy">Glassy</option>
                      <option value="matte">Matte</option>
                      <option value="die_cut">Die cut</option>
                      <option value="velvet">Velvet touch</option>
                      <option value="leaf">Leaf</option>
                      <option value="non_tearable">Non Tearable</option>
                    </select>
                    <div class="form-text">Single side, single design.</div>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label required">Quantity</label>
                    <input id="visitingQty" type="number" min="100" value="100" class="form-control" />
                    <div class="form-text" id="visitingMinHelp">Minimum quantity applies based on card type.</div>
                  </div>
                </div>
              </div>

              <div class="mb-3 d-none" id="invitationGroup">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label required">Quantity</label>
                    <input id="invitationQty" type="number" min="500" value="500" class="form-control" />
                    <div class="form-text">Minimum quantity: 500 nos.</div>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label required">Need invitations by</label>
                    <input id="invitationNeedBy" type="date" class="form-control" />
                    <div class="form-text">Provide your required delivery/pickup date.</div>
                  </div>
                  <div class="col-12">
                    <label class="form-label required">Do you need us to design it?</label>
                    <select id="invitationDesignHelp" class="form-select">
                      <option value="need_design">Yes, I need design help</option>
                      <option value="have_design">No, I already have a design</option>
                    </select>
                  </div>
                </div>
                <div class="form-text mt-2">Pricing depends on material and design. Submit your details and we’ll contact you.</div>
              </div>

              <div class="mb-3" id="uploadGroup">
                <label class="form-label required">Upload artwork / reference images</label>
                <input id="images" class="form-control" type="file" accept="image/*,application/pdf" multiple />
                <div id="previews" class="d-flex flex-wrap mt-2"></div>
                <div class="form-text" id="uploadHelp">Accepts JPG, PNG, PDF. Multiple files allowed.</div>
              </div>

              <div class="mb-3 row">
                <div class="col-md-6">
                  <label class="form-label required">Banner size</label>
                  <select id="sizeSelect" class="form-select" required>
                    <option value="3x2">3 ft × 2 ft</option>
                    <option value="4x3">4 ft × 3 ft</option>
                    <option value="6x4">6 ft × 4 ft</option>
                    <option value="custom">Custom size (enter below)</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Quantity</label>
                  <input id="quantity" type="number" min="1" value="1" class="form-control" />
                </div>
              </div>

              <div id="customSizeInputs" class="mb-3 d-none">
                <div class="row">
                  <div class="col-md-6">
                    <label class="form-label">Width (ft)</label>
                    <input id="customW" type="number" min="1" step="0.1" class="form-control" placeholder="e.g. 5" />
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Height (ft)</label>
                    <input id="customH" type="number" min="1" step="0.1" class="form-control" placeholder="e.g. 2" />
                  </div>
                </div>
                <div class="form-text mt-2">Custom pricing is calculated per sq ft based on the selected service and material.</div>
              </div>

              <div class="mb-3">
                <label class="form-label required">Material</label>
                <select id="finish" class="form-select">
                  <option value="normal_flex">Normal Flex</option>
                  <option value="star_flex">Star Flex</option>
                  <option value="vinyl">Vinyl</option>
                </select>
                <div class="form-text">Rates are per sq ft (Star Flex print-only may vary; final confirmation after review).</div>
              </div>

              <div class="mb-3">
                <label class="form-label required">Delivery option</label>
                <div class="d-flex gap-3">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="delivery" id="deliveryYes" value="deliver" checked>
                    <label class="form-check-label" for="deliveryYes">Deliver to address</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="delivery" id="pickup" value="pickup">
                    <label class="form-check-label" for="pickup">Collect from shop</label>
                  </div>
                </div>
              </div>

              <!-- Budget option removed per request -->

              <div class="mb-3" id="instructionsGroup">
                <label class="form-label">Additional instructions for designers</label>
                <textarea id="instructions" rows="3" class="form-control" placeholder="Tell our designers how you'd like the banner to look"></textarea>
              </div>

              <div class="mb-3 border rounded p-3 bg-white">
                <h6>Order Summary</h6>
                <div class="d-flex justify-content-between small-muted"><div>Price</div><div id="priceDisplay">₹0</div></div>
                <div class="d-flex justify-content-between small-muted"><div>Delivery</div><div id="deliveryFee">₹50</div></div>
                <hr>
                <div class="d-flex justify-content-between fw-bold"><div>Total</div><div id="totalDisplay">₹0</div></div>
              </div>

              <div class="d-flex flex-wrap gap-2">
                <button id="payBtn" type="button" class="btn btn-primary" disabled>Pay Online & Place Order</button>
                <button id="saveQuote" type="button" class="btn btn-outline-secondary">Request Quote (no payment)</button>
              </div>

            </form>

          </div>
        </div>

        <div class="col-lg-5 mb-4">
          <div class="card card-ghost p-3">
            <h6 class="mb-3">What happens next</h6>
            <ol>
              <li>We confirm design & print details after order.</li>
              <li>Print happens within 5–36 hours depending on workload.</li>
              <li>Delivered or kept for pickup as per your choice.</li>
            </ol>
            <hr>
            <h6 class="mb-2">Shop & Contact</h6>
            <p class="small-muted mb-0">RR Digi Media<br>24/50 Visalam Complex<br>Town Extension Road<br>Old bus stop back side<br>Mayiladuthurai 609001<br>Phone: <a href="tel:+919025647318">+91 90256 47318</a><br>Email: <a href="mailto:rrdigimedia.myl@gmail.com">rrdigimedia.myl@gmail.com</a></p>
            <div class="mt-3">
              <a href="#contact" class="btn btn-outline-primary btn-sm">Contact support</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="text-center small-muted" id="footer">© <span id="year"></span> RR Digi Media — All rights reserved • <a href="privacy.html">Privacy</a> • <a href="terms.html">Terms</a></footer>
  </main>

  <!-- SCRIPTS (inline single-file) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    // --- Login simulation ---
  const loginBtn = document.getElementById('loginBtn');
  const signupBtn = document.getElementById('signupBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const authBtns = document.getElementById('authBtns');
  const signupBtnWrap = document.getElementById('signupBtnWrap');
  const userMenu = document.getElementById('userMenu');
  const userEmailMenu = document.getElementById('userEmailMenu');
  const adminLink = document.getElementById('adminLink');
  let loggedIn = false;
  let loggedEmail = '';

    async function api(path, method='GET', body){
      const res = await fetch('/api/auth'+path, {
        method,
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: body ? JSON.stringify(body) : undefined
      });
      const data = await res.json().catch(()=>({}));
      if(!res.ok) throw new Error(data.error || 'Request failed');
      return data;
    }

    async function paymentsApi(path, method='POST', body){
      const res = await fetch('/api/payments'+path, {
        method,
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: body ? JSON.stringify(body) : undefined
      });
      const data = await res.json().catch(()=>({}));
      if(!res.ok) throw new Error(data.error || 'Payment request failed');
      return data;
    }

    // Login/Signup handled by dedicated pages


    async function refreshAuthUI(){
      try{
        const me = await api('/me');
        loggedIn = true;
        loggedEmail = me.user.email;
        if(userEmailMenu) userEmailMenu.textContent = loggedEmail;
        authBtns && authBtns.classList.add('d-none');
        signupBtnWrap && signupBtnWrap.classList.add('d-none');
        userMenu && userMenu.classList.remove('d-none');
        if(adminLink) adminLink.classList.toggle('d-none', !me.user.is_admin);
        // Admins should not use the customer site; redirect to Admin Panel
        if(me.user.is_admin){
          window.location.href = 'admin.html';
          return;
        }
      }catch{
        loggedIn = false;
        loggedEmail = '';
        authBtns && authBtns.classList.remove('d-none');
        signupBtnWrap && signupBtnWrap.classList.remove('d-none');
        userMenu && userMenu.classList.add('d-none');
      }
      updatePayButtonState();
    }

    logoutBtn && logoutBtn.addEventListener('click', async () => {
      try{ await api('/logout','POST'); }catch{}
      loggedIn = false;
      loggedEmail = '';
      authBtns && authBtns.classList.remove('d-none');
      signupBtnWrap && signupBtnWrap.classList.remove('d-none');
      userMenu && userMenu.classList.add('d-none');
      updatePayButtonState();
    });

    // --- Reveal order section only when Order Now pressed ---
    const orderSection = document.getElementById('orderSection');

    async function ensureLoggedInForOrdering(){
      if(loggedIn) return true;
      try{
        await refreshAuthUI();
      }catch{}
      if(loggedIn) return true;
      window.location.href = 'login.html?next=order';
      return false;
    }

    const revealOrder = async (e) => {
      if (e) e.preventDefault();
      const ok = await ensureLoggedInForOrdering();
      if(!ok) return;
      if (!orderSection) return;
      // reveal and scroll
      orderSection.style.display = 'block';
      orderSection.classList.add('reveal');
      orderSection.setAttribute('aria-hidden','false');
      orderSection.scrollIntoView({behavior: 'smooth', block: 'start'});
      // focus first input for keyboard users
      const firstInput = orderSection.querySelector('select, input, textarea, button');
      if(firstInput) firstInput.focus();
    };

    document.getElementById('ctaOrder').addEventListener('click', revealOrder);
    document.getElementById('navOrder').addEventListener('click', revealOrder);
    document.getElementById('contactOrderBtn').addEventListener('click', revealOrder);

    // --- File previews ---
    const imagesInput = document.getElementById('images');
    const previews = document.getElementById('previews');
    imagesInput && imagesInput.addEventListener('change', () => {
      previews.innerHTML = '';
      const files = Array.from(imagesInput.files).slice(0,8);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'preview-img';
            img.title = file.name;
            previews.appendChild(img);
          } else {
            const div = document.createElement('div');
            div.className = 'border rounded p-2 me-2 mb-2';
            div.style.maxWidth = '160px';
            div.textContent = file.name;
            previews.appendChild(div);
          }
        };
        if (file.type.startsWith('image/')) reader.readAsDataURL(file);
        else reader.readAsArrayBuffer(file);
      });
    });

    // --- Price calc & payment simulation ---
  const sizeSelect = document.getElementById('sizeSelect');
    const customSizeInputs = document.getElementById('customSizeInputs');
    const customW = document.getElementById('customW');
    const customH = document.getElementById('customH');
    const finish = document.getElementById('finish');
    const quantity = document.getElementById('quantity');
    const deliveryYes = document.getElementById('deliveryYes');
    const deliveryFeeEl = document.getElementById('deliveryFee');
    const priceDisplay = document.getElementById('priceDisplay');
    const totalDisplay = document.getElementById('totalDisplay');
    const payBtn = document.getElementById('payBtn');
    const saveQuote = document.getElementById('saveQuote');
    const orderCategory = document.getElementById('orderCategory');
    const serviceType = document.getElementById('serviceType');
    const uploadGroup = document.getElementById('uploadGroup');
    const uploadHelp = document.getElementById('uploadHelp');
    const instructionsGroup = document.getElementById('instructionsGroup');

    const photoGroup = document.getElementById('photoGroup');
    const photoSize = document.getElementById('photoSize');
    const photoDesign = document.getElementById('photoDesign');
    const photoQty = document.getElementById('photoQty');

    const visitingGroup = document.getElementById('visitingGroup');
    const visitingType = document.getElementById('visitingType');
    const visitingQty = document.getElementById('visitingQty');
    const visitingMinHelp = document.getElementById('visitingMinHelp');

    const invitationGroup = document.getElementById('invitationGroup');
    const invitationQty = document.getElementById('invitationQty');
    const invitationNeedBy = document.getElementById('invitationNeedBy');
    const invitationDesignHelp = document.getElementById('invitationDesignHelp');

    function setUploadLabelRequired(on){
      if(!uploadGroup) return;
      const label = uploadGroup.querySelector('label.form-label');
      if(label) label.classList.toggle('required', !!on);
    }

    function getVisitingRules(type){
      // Per-batch pricing (as requested)
      // batchQty is the unit that the price covers.
      const rules = {
        glassy: { batchQty: 1000, minQty: 1000, batchPrice: 750 },
        matte: { batchQty: 1000, minQty: 1000, batchPrice: 1100 },
        die_cut: { batchQty: 1000, minQty: 1000, batchPrice: 1500 },
        velvet: { batchQty: 100, minQty: 100, batchPrice: 700 },
        leaf: { batchQty: 100, minQty: 100, batchPrice: 700 },
        non_tearable: { batchQty: 100, minQty: 100, batchPrice: 700 }
      };
      return rules[type] || rules.velvet;
    }

    function updateOrderFieldsVisibility(){
      const cat = orderCategory ? String(orderCategory.value || 'banner') : 'banner';

      // Default hide/show
      photoGroup && photoGroup.classList.toggle('d-none', cat !== 'photo');
      visitingGroup && visitingGroup.classList.toggle('d-none', cat !== 'visiting');
      invitationGroup && invitationGroup.classList.toggle('d-none', cat !== 'invitation');

      // Banner-specific inputs
      const bannerMode = (cat === 'banner');
      if(serviceType){
        const group = serviceType.closest('.mb-3');
        if(group) group.classList.toggle('d-none', !bannerMode);
      }
      const showBannerSize = bannerMode;
      if(sizeSelect){
        const group = sizeSelect.closest('.mb-3');
        if(group) group.classList.toggle('d-none', !showBannerSize);
      }
      if(customSizeInputs){
        // Only relevant for banner
        if(!bannerMode) customSizeInputs.classList.add('d-none');
        else customSizeInputs.classList.toggle('d-none', sizeSelect.value !== 'custom');
      }
      if(finish){
        const group = finish.closest('.mb-3');
        if(group) group.classList.toggle('d-none', !bannerMode);
      }

      // Quantity inputs
      if(quantity){
        const group = quantity.closest('.col-md-6');
        // banner qty lives inside the size row; hide that row for non-banner already
        if(group && !bannerMode) {
          // keep untouched
        }
      }

      // Instructions: show for banner design + invitation details
      if(instructionsGroup){
        if(cat === 'invitation'){
          instructionsGroup.classList.remove('d-none');
          const label = instructionsGroup.querySelector('label.form-label');
          if(label) label.textContent = 'Invitation details / message';
          if(document.getElementById('instructions')){
            document.getElementById('instructions').placeholder = 'Event details, names, language, material preference, any notes…';
          }
        }else{
          const isDesign = serviceType && serviceType.value === 'design';
          instructionsGroup.classList.toggle('d-none', !(bannerMode && isDesign));
          const label = instructionsGroup.querySelector('label.form-label');
          if(label) label.textContent = 'Additional instructions for designers';
        }
      }

      // Upload requirements
      if(cat === 'photo'){
        setUploadLabelRequired(true);
        if(uploadHelp) uploadHelp.textContent = 'Upload your photo(s). Accepts JPG, PNG, PDF. Multiple files allowed.';
      }else if(cat === 'banner'){
        const isDesign = serviceType && serviceType.value === 'design';
        setUploadLabelRequired(!isDesign);
        if(uploadHelp){
          uploadHelp.textContent = isDesign
            ? 'Accepts JPG, PNG, PDF. Multiple files allowed. Upload references to guide the design.'
            : 'Accepts JPG, PNG, PDF. Multiple files allowed.';
        }
      }else{
        // visiting / invitation
        setUploadLabelRequired(false);
        if(uploadHelp) uploadHelp.textContent = 'Optional: upload reference images / logo / sample design (JPG, PNG, PDF).';
      }

      // Visiting min quantity helper
      if(cat === 'visiting' && visitingType && visitingQty){
        const r = getVisitingRules(visitingType.value);
        visitingQty.min = String(r.minQty);
        if(Number(visitingQty.value || 0) < r.minQty){
          visitingQty.value = String(r.minQty);
        }
        if(visitingMinHelp){
          visitingMinHelp.textContent = `Minimum quantity: ${r.minQty}. Pricing is per batch of ${r.batchQty}.`;
        }
      }

      // Button behavior
      if(payBtn && saveQuote){
        if(cat === 'invitation'){
          payBtn.disabled = true;
          payBtn.textContent = 'Online payment not available for Invitations';
          saveQuote.textContent = 'Submit Invitation Request';
        }else{
          payBtn.textContent = 'Pay Online & Place Order';
          saveQuote.textContent = 'Request Quote (no payment)';
          updatePayButtonState();
        }
      }

      calculate();
    }

    function calculate(){
      const opt = sizeSelect ? sizeSelect.selectedOptions[0] : null;

      const cat = orderCategory ? String(orderCategory.value || 'banner') : 'banner';
      let price = 0;

      if(cat === 'banner'){
        const qty = Math.max(1, Number(quantity.value || 1));
        const material = finish ? String(finish.value || 'normal_flex') : 'normal_flex';
        const svc = serviceType ? String(serviceType.value || 'print') : 'print';

        const rates = {
          normal_flex: { print: 7, design: 10 },
          // Print-only Star Flex varies (₹20–₹25). Using ₹25.
          star_flex: { print: 25, design: 45 },
          vinyl: { print: 40, design: 75 }
        };
        const perSqFt = (rates[material] && rates[material][svc]) ? rates[material][svc] : 0;

        let w = 0;
        let h = 0;
        if(opt && opt.value === 'custom'){
          w = Number(customW.value || 0);
          h = Number(customH.value || 0);
        }else if(opt && opt.value){
          const m = String(opt.value).match(/^(\d+(?:\.\d+)?)x(\d+(?:\.\d+)?)$/);
          if(m){ w = Number(m[1]); h = Number(m[2]); }
        }
        const sqft = Math.max(0, w * h);
        price = Math.round(sqft * perSqFt * qty);
      }

      if(cat === 'photo'){
        const qty = Math.max(1, Number(photoQty ? photoQty.value : 1));
        const sizeKey = photoSize ? String(photoSize.value) : '';
        const designKey = photoDesign ? String(photoDesign.value) : 'normal';
        // Assumption: price list is per piece for the chosen size/design.
        const photoPrices = {
          '12x18': { normal: 600, gold_half: 800, gold_1inch: 900 },
          '24x12': { normal: 1000, gold_half: 1100, gold_1inch: 1200 },
          '36x12': { normal: 1200, gold_half: 1350, gold_1inch: 1450 },
          '20x16': { normal: 1400, gold_half: 1600, gold_1inch: 1700 },
          '24x16': { normal: 1800, gold_half: 1900, gold_1inch: 2000 },
          '18x24': { normal: 1600, gold_half: 1700, gold_1inch: 1800 },
          '20x24': { normal: 1800, gold_half: 1900, gold_1inch: 2000 },
          '20x30': { normal: 2500, gold_half: 2600, gold_1inch: 2700 },
          '20x36': { normal: 2800, gold_half: 3000, gold_1inch: 3200 },
          '20x40': { normal: 3300, gold_half: 3400, gold_1inch: 3600 },
          '24x36': { normal: 3500, gold_half: 3600, gold_1inch: 3700 },
          '30x40': { normal: 4300, gold_half: 4400, gold_1inch: 4500 },
          '24x40': { normal: 4300, gold_half: 4500, gold_1inch: 4600 }
        };
        const unit = (photoPrices[sizeKey] && photoPrices[sizeKey][designKey]) ? photoPrices[sizeKey][designKey] : 0;
        price = Math.round(unit * qty);
      }

      if(cat === 'visiting'){
        const type = visitingType ? String(visitingType.value) : 'velvet';
        const qtyRaw = Math.max(0, Number(visitingQty ? visitingQty.value : 0));
        const r = getVisitingRules(type);
        const qty = Math.max(r.minQty, qtyRaw);
        const batches = Math.ceil(qty / r.batchQty);
        price = batches * r.batchPrice;
      }

      if(cat === 'invitation'){
        // Quote request only
        price = 0;
      }

      let deliveryFee = (deliveryYes && deliveryYes.checked) ? 50 : 0;
      if(price >= 2000) deliveryFee = 0; // free delivery threshold
      if((orderCategory && orderCategory.value === 'invitation')) deliveryFee = 0;
      if(priceDisplay) priceDisplay.textContent = '₹' + price;
      if(deliveryFeeEl) deliveryFeeEl.textContent = '₹' + deliveryFee;
      if(totalDisplay) totalDisplay.textContent = '₹' + (price + deliveryFee);
      return {price, deliveryFee, total: price + deliveryFee};
    }

    if(orderCategory) orderCategory.addEventListener('change', updateOrderFieldsVisibility);
    if(sizeSelect) sizeSelect.addEventListener('change', () => {
      if(orderCategory && orderCategory.value === 'banner'){
        customSizeInputs.classList.toggle('d-none', sizeSelect.value !== 'custom');
      }
      calculate();
    });
    if(serviceType) serviceType.addEventListener('change', updateOrderFieldsVisibility);
    if(photoSize) photoSize.addEventListener('change', calculate);
    if(photoDesign) photoDesign.addEventListener('change', calculate);
    if(photoQty) photoQty.addEventListener('input', calculate);
    if(visitingType) visitingType.addEventListener('change', updateOrderFieldsVisibility);
    if(visitingQty) visitingQty.addEventListener('input', calculate);
    if(invitationQty) invitationQty.addEventListener('input', calculate);
    if(customW) customW.addEventListener('input', calculate);
    if(customH) customH.addEventListener('input', calculate);
    if(finish) finish.addEventListener('change', calculate);
    if(quantity) quantity.addEventListener('input', calculate);
    document.querySelectorAll('input[name="delivery"]').forEach(el => el.addEventListener('change', calculate));

    function updatePayButtonState(){ if(payBtn) payBtn.disabled = !loggedIn; }
    updatePayButtonState();

    payBtn && payBtn.addEventListener('click', async () => {
      if(!loggedIn){ alert('Please log in to pay and place an order.'); return; }
      if(orderCategory && orderCategory.value === 'invitation'){
        alert('Invitations are quote request only. Please use “Submit Invitation Request”.');
        return;
      }
      const summary = calculate();
      if(summary.total <= 0){ alert('Please choose a valid size/quantity first.'); return; }
      const proceed = confirm('Proceed to place order for ' + '₹' + summary.total + '?');
      if(!proceed) return;

      // Validate uploads for photo prints
      if(orderCategory && orderCategory.value === 'photo'){
        const files = imagesInput && imagesInput.files ? Array.from(imagesInput.files) : [];
        if(!files.length){
          alert('Please upload at least one photo file.');
          return;
        }
      }

      // Build multipart form for backend
      const fd = new FormData();
      const append = (k,v) => fd.append(k, v);

      const cat = orderCategory ? String(orderCategory.value || 'banner') : 'banner';
      if(cat === 'banner'){
        append('serviceType', 'banner');
        append('size', sizeSelect.value);
        append('customW', document.getElementById('customW').value || '');
        append('customH', document.getElementById('customH').value || '');
        append('finish', document.getElementById('finish').value);
        append('quantity', document.getElementById('quantity').value);
        append('instructions', document.getElementById('instructions').value || '');
        append('extra', JSON.stringify({ bannerMode: document.getElementById('serviceType').value }));
      }
      if(cat === 'photo'){
        append('serviceType', 'photo_print');
        append('size', photoSize ? photoSize.value : '');
        append('finish', photoDesign ? photoDesign.value : 'normal');
        append('quantity', String(photoQty ? (photoQty.value || 1) : 1));
        append('instructions', document.getElementById('instructions').value || '');
      }
      if(cat === 'visiting'){
        const rules = getVisitingRules(visitingType.value);
        const qtyNum = Number(visitingQty.value || 0);
        if(qtyNum < rules.minQty){
          alert('Minimum quantity for this visiting card type is ' + rules.minQty + '.');
          return;
        }
        append('serviceType', 'visiting_card');
        append('size', 'single_side_single_design');
        append('finish', visitingType.value);
        append('quantity', String(qtyNum));
        append('instructions', document.getElementById('instructions').value || '');
      }

      const deliveryVal = (document.getElementById('deliveryYes').checked ? 'deliver' : 'pickup');
      append('delivery', deliveryVal);
      append('price', summary.price);
      append('deliveryFee', summary.deliveryFee);
      append('total', summary.total);
      const files = imagesInput && imagesInput.files ? Array.from(imagesInput.files).slice(0,8) : [];
      files.forEach(f => fd.append('images', f));

      try{
        payBtn.disabled = true;

        // 1) Create the order record first (unpaid)
        const res = await fetch('/api/orders', { method:'POST', body: fd, credentials:'include' });
        const data = await res.json();
        if(!res.ok) throw new Error(data.error || 'Order failed');

        // 2) Create a Razorpay order on the server
        let rp;
        try{
          rp = await paymentsApi('/razorpay/create', 'POST', { orderId: data.orderId });
        }catch(e){
          alert('Order placed (unpaid). Payments are not available right now.\nReference: ' + data.orderId);
          return;
        }

        if(!window.Razorpay){
          alert('Order placed (unpaid). Payment gateway did not load.\nReference: ' + data.orderId);
          return;
        }

        // 3) Open Razorpay Checkout
        const options = {
          key: rp.keyId,
          amount: rp.amount,
          currency: rp.currency,
          name: 'RR Digi Media',
          description: 'Online order payment',
          order_id: rp.razorpayOrderId,
          prefill: { email: loggedEmail || '' },
          handler: async function (response){
            try{
              await paymentsApi('/razorpay/verify', 'POST', {
                orderId: data.orderId,
                razorpay_order_id: response.razorpay_order_id,
                razorpay_payment_id: response.razorpay_payment_id,
                razorpay_signature: response.razorpay_signature
              });
              alert('Payment successful! Order confirmed.\nReference: ' + data.orderId);
              document.getElementById('orderForm').reset();
              previews.innerHTML = '';
              if(sizeSelect) sizeSelect.dispatchEvent(new Event('change'));
            }catch(err){
              alert('Payment received, but verification failed. Please contact support with Reference: ' + data.orderId);
            }finally{
              payBtn.disabled = !loggedIn;
            }
          },
          modal: {
            ondismiss: function (){
              alert('Payment was not completed. Your order is saved as unpaid.\nReference: ' + data.orderId);
              payBtn.disabled = !loggedIn;
            }
          }
        };

        const rzp = new window.Razorpay(options);
        rzp.open();
      }catch(err){
        alert(err.message);
      }finally{
        // If Razorpay opened, button state is handled in handlers.
        if(payBtn) payBtn.disabled = !loggedIn;
      }
    });

    saveQuote && saveQuote.addEventListener('click', () => {
      if(!loggedIn){ alert('Please log in to continue.'); return; }

      const cat = orderCategory ? String(orderCategory.value || 'banner') : 'banner';
      if(cat !== 'invitation'){
        const summary = calculate();
        alert('Quote requested for total ₹' + summary.total + '. We will contact you.');
        return;
      }

      // Invitation quote request: submit an order record with total 0.
      const qtyNum = Math.max(0, Number(invitationQty ? invitationQty.value : 0));
      if(qtyNum < 500){ alert('Minimum quantity for invitations is 500.'); return; }
      if(invitationNeedBy && !invitationNeedBy.value){ alert('Please select the date you need the invitations by.'); return; }

      const fd = new FormData();
      const append = (k,v) => fd.append(k, v);
      append('serviceType', 'invitation');
      append('size', 'quote');
      append('finish', invitationDesignHelp ? invitationDesignHelp.value : 'need_design');
      append('quantity', String(qtyNum));
      append('delivery', (document.getElementById('deliveryYes').checked ? 'deliver' : 'pickup'));
      append('price', 0);
      append('deliveryFee', 0);
      append('total', 0);
      const details = {
        needBy: invitationNeedBy ? invitationNeedBy.value : '',
        design: invitationDesignHelp ? invitationDesignHelp.value : ''
      };
      append('instructions', (document.getElementById('instructions').value || '') + (document.getElementById('instructions').value ? '\n\n' : '') + 'Invitation details: ' + JSON.stringify(details));
      const files = imagesInput && imagesInput.files ? Array.from(imagesInput.files).slice(0,8) : [];
      files.forEach(f => fd.append('images', f));

      (async () => {
        try{
          const res = await fetch('/api/orders', { method:'POST', body: fd, credentials:'include' });
          const data = await res.json();
          if(!res.ok) throw new Error(data.error || 'Request failed');
          alert('Invitation request submitted! Reference: ' + data.orderId + '\nWe will contact you soon.');
          document.getElementById('orderForm').reset();
          previews.innerHTML = '';
          if(orderCategory) orderCategory.value = 'banner';
          updateOrderFieldsVisibility();
        }catch(err){
          alert(err.message);
        }
      })();
    });

    // set year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Accessibility: allow keyboard trigger for Order Now via Enter key when focused
    ['ctaOrder','navOrder','contactOrderBtn'].forEach(id => {
      const el = document.getElementById(id);
      if(!el) return;
      el.addEventListener('keyup', (ev) => { if(ev.key === 'Enter') revealOrder(ev); });
    });

    // initial calculate (if order shown later)
    // don't reveal order on load
    if(sizeSelect) sizeSelect.dispatchEvent(new Event('change'));
    updateOrderFieldsVisibility();
    async function refreshAndMaybeOpenOrder(){
      await refreshAuthUI();
      const params = new URLSearchParams(window.location.search);
      const openOrder = params.get('openOrder') === '1' || window.location.hash === '#order';
      if(openOrder){
        await revealOrder();
        // Clear the flag so refresh/back doesn't keep re-opening it.
        const url = new URL(window.location.href);
        url.searchParams.delete('openOrder');
        history.replaceState({}, '', url.pathname + url.search + url.hash);
      }
    }

    refreshAndMaybeOpenOrder();

    // Back/forward cache can restore a previously-rendered logged-in UI.
    // Always re-check auth on page show.
    window.addEventListener('pageshow', () => {
      refreshAndMaybeOpenOrder();
    });
  </script>
</body>
</html>
